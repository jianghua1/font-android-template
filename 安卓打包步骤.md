# 安卓打包步骤

## 项目概述

这是一个基于 Vue 3 + Vite + Capacitor 的混合移动应用项目，可以打包成安卓应用。

## 环境要求

在开始打包之前，请确保已安装以下环境：

- Node.js (推荐 18+ 版本)
- Java JDK 21 (根据 capacitor.build.gradle 配置)
- Android Studio
- Android SDK (API 35)
- Gradle

## 打包步骤

### 1. 安装依赖

```bash
# 使用 npm 或 pnpm 安装项目依赖
npm install
# 或
pnpm install
```

### 2. 添加 Android 平台（如果尚未添加）

```bash
# 添加 Android 平台到项目
npx cap add android
```

### 3. 构建 Web 应用

```bash
# 构建 Vue 项目到 dist 目录
npm run build
# 或
pnpm build
```

### 4. 同步到 Android 项目

```bash
# 将 Web 构建同步到 Android 项目
npx cap sync android
```

### 5. 打开 Android Studio

```bash
# 在 Android Studio 中打开 Android 项目
npx cap open android
```

### 6. 在 Android Studio 中构建 APK

#### 方法一：构建 Debug 版本（无需签名，用于测试）

**通过 Android Studio GUI：**
1. 打开 Android Studio
2. 选择 `Build` → `Build Bundle(s) / APK(s)` → `Build APK(s)`
3. 等待构建完成

**通过命令行构建：**
```bash
# 进入 android 目录
cd android

# 清理项目
./gradlew clean

# 构建 debug APK（无需签名）
./gradlew assembleDebug

# 在 Windows 上使用
gradlew.bat assembleDebug
```

#### 方法二：构建 Release 版本（需要签名，用于发布）

**通过 Android Studio GUI：**
1. 打开 Android Studio
2. 选择 `Build` → `Generate Signed Bundle / APK`
3. 选择 `APK`
4. 创建或选择现有的密钥库文件
5. 填写密钥库密码和密钥信息
6. 选择构建类型：`release`
7. 选择签名版本：推荐 V1 + V2
8. 点击 `Finish` 开始构建

**通过命令行构建：**
```bash
# 进入 android 目录
cd android

# 清理项目
./gradlew clean

# 构建 release APK（需要签名配置）
./gradlew assembleRelease

# 在 Windows 上使用
gradlew.bat assembleRelease
```

### 7. 找到生成的 APK 文件

**Debug 版本 APK 文件位置：**
```
android/app/build/outputs/apk/debug/app-debug.apk
```

**Release 版本 APK 文件位置：**
```
android/app/build/outputs/apk/release/app-release.apk
```

## 配置说明

### 应用基本信息

- **应用ID**: `com.example.app`
- **应用名称**: `stock-message-box2`
- **最低SDK版本**: 23 (Android 6.0)
- **目标SDK版本**: 35 (Android 14)
- **编译SDK版本**: 35

### 构建配置

项目使用以下构建工具和版本：

- **Gradle**: 8.11.1
- **Android Gradle Plugin**: 8.7.2
- **Java版本**: 21

## 常见问题解决

### 1. 构建失败：缺少 Android SDK

- 确保已安装 Android SDK Platform 35
- 在 Android Studio 中安装相应的 SDK 版本

### 2. Java 版本不匹配

- 确保安装 Java JDK 21
- 设置 JAVA_HOME 环境变量指向 JDK 21 安装目录

### 3. 签名问题

- 确保密钥库文件存在且密码正确
- 如果忘记密钥库信息，需要重新创建新的密钥库

### 4. Gradle 下载超时问题

如果遇到 Gradle 下载超时错误，可以尝试以下解决方案：

#### 方法一：使用国内镜像（推荐）

在 `android/gradle/wrapper/gradle-wrapper.properties` 文件中修改下载地址：

```properties
# 将原来的
distributionUrl=https\://services.gradle.org/distributions/gradle-8.11.1-all.zip

# 修改为国内镜像
distributionUrl=https\://mirrors.cloud.tencent.com/gradle/gradle-8.11.1-all.zip
# 或
distributionUrl=https\://mirrors.aliyun.com/gradle/gradle-8.11.1-all.zip
```

#### 方法二：手动下载 Gradle

1. 手动下载 Gradle 发行版：
   - 从官网下载：https://gradle.org/releases/
   - 或从国内镜像下载：https://mirrors.cloud.tencent.com/gradle/

2. 将下载的 zip 文件放到用户目录的 `.gradle/wrapper/dists/` 对应文件夹中

#### 方法三：配置代理

在 `android/gradle.properties` 文件中添加代理配置：

```properties
systemProp.http.proxyHost=your-proxy-host
systemProp.http.proxyPort=your-proxy-port
systemProp.https.proxyHost=your-proxy-host
systemProp.https.proxyPort=your-proxy-port
```

### 5. Capacitor 同步问题

```bash
# 如果同步失败，可以尝试删除并重新添加 Android 平台
npx cap rm android
npx cap add android
npx cap sync android
```

## 优化建议

### 1. 启用代码压缩

在 `android/app/build.gradle` 中启用代码压缩：

```gradle
buildTypes {
    release {
        minifyEnabled true
        shrinkResources true
        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
}
```

### 2. 添加应用图标

替换 `android/app/src/main/res/mipmap-*` 目录下的图标文件

### 3. 配置应用权限

在 `android/app/src/main/AndroidManifest.xml` 中添加所需权限

## 发布准备

在发布到应用商店之前：

1. 测试应用在不同设备和 Android 版本上的兼容性
2. 优化应用性能
3. 准备应用截图和描述
4. 确保符合 Google Play 商店的政策要求

## 注意事项

- 首次构建可能需要较长时间下载依赖
- 确保开发机器有足够的内存和存储空间
- 建议在发布前进行充分的测试
